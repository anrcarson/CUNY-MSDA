127	, #Opppasserchange
128	, #Opprusherchange
129	, #Oppreceiverchange
130	, #OppYearsCoaching
131	, #OppYearsSincePlayoffs
132	, #OppYearsSincePlayoffsSameCoach
133	, #TeamTop1Passer
134	, #TeamTop3Receivers
135	, #TeamTop3Rushers
136	, #TeamTop1PuntReturner
137	, #TeamTop1KickReturner
138	, #TeamTop1Kicker
139	, #TeamTop1Punter
140	, #TeamTop2Interceptors
141	, #TeamTop1TDReturner
142	, #TeamTop3PassDefenders
143	, #TeamTop3Sackers
144	, #TeamTop3ForcedFumblers
145	, #TeamTop3Tacklers
146	, #TeamTop3AssistantTacklers
147	, #OppTop1Passer
148	, #OppTop3Receivers
149	, #OppTop3Rushers
150	, #OppTop1PuntReturner
151	, #OppTop1KickReturner
152	, #OppTop1Kicker
153	, #OppTop1Punter
154	, #OppTop2Interceptors
155	, #OppTop1TDReturner
156	, #OppTop3PassDefenders
157	, #OppTop3Sackers
158	, #OppTop3ForcedFumblers
159	, #OppTop3Tacklers
160	, #OppTop3AssistantTacklers
# 161	, #TeamTeam
# 162	, #TeamFirstDowns
# 163	, #TeamRushAttempts
# 164	, #TeamRushYards
# 165	, #TeamRushTDs
# 166	, #TeamPassCompletions
# 167	, #TeamPassAttempts
# 168	, #TeamPassYards
# 169	, #TeamPassTDs
# 170	, #TeamInterceptions
# 171	, #TeamSacksReceived
# 172	, #TeamSackYardsLost
# 173	, #TeamNetPassingYards
# 174	, #TeamTotalYards
# 175	, #TeamFumbles
# 176	, #TeamFumblesLost
# 177	, #TeamTurnovers
# 178	, #TeamPenaltyCount
# 179	, #TeamPenaltyYards
# 180	, #TeamThirdDownConv
# 181	, #TeamThirdDownAttem
# 182	, #TeamFourthDownConv
# 183	, #TeamFourthDownAttem
# 184	, #TeamTotalPlays
# 185	, #TeamTimeofPossession
# 186	, #TeamTm
# 187	, #TeamXPM
# 188	, #TeamXPA
# 189	, #TeamFGM
# 190	, #TeamFGA
# 191	, #TeamPnt
# 192	, #TeamTotalDrives
# 193	, #TeamAvgPlaysPerDrive
# 194	, #TeamAvgTimeLengthDrive
# 195	, #TeamAvgYardsPerDrive
# 196	, #TeamLOS
# 197	, #OppTeam
# 198	, #OppFirstDowns
# 199	, #OppRushAttempts
# 200	, #OppRushYards
# 201	, #OppRushTDs
# 202	, #OppPassCompletions
# 203	, #OppPassAttempts
# 204	, #OppPassYards
# 205	, #OppPassTDs
# 206	, #OppInterceptions
# 207	, #OppSacksReceived
# 208	, #OppSackYardsLost
# 209	, #OppNetPassingYards
# 210	, #OppTotalYards
# 211	, #OppFumbles
# 212	, #OppFumblesLost
# 213	, #OppTurnovers
# 214	, #OppPenaltyCount
# 215	, #OppPenaltyYards
# 216	, #OppThirdDownConv
# 217	, #OppThirdDownAttem
# 218	, #OppFourthDownConv
# 219	, #OppFourthDownAttem
# 220	, #OppTotalPlays
# 221	, #OppTimeofPossession
# 222	, #OppTm
# 223	, #OppXPM
# 224	, #OppXPA
# 225	, #OppFGM
# 226	, #OppFGA
# 227	, #OppPnt
# 228	, #OppTotalDrives
# 229	, #OppAvgPlaysPerDrive
# 230	, #OppAvgTimeLengthDrive
# 231	, #OppAvgYardsPerDrive
# 232	, #OppLOS
# 233	, #TeamRushYdsPerAttem
# 234	, #TeamPassCompletionRatio
# 235	, #TeamPassYardsPerAttempt
# 236	, #TeamPassYardsPerCompletion
# 237	, #TeamTDsPerTotalYards
# 238	, #TeamIntPerPassAttempts
# 239	, #TeamSacksPerPlays
# 240	, #TeamYardsPerPlay
# 241	, #TeamFumblesLostPerFumbles
# 242	, #TeamPenaltyYardsPerPenalty
# 243	, #TeamThirdDownConvRatio
# 244	, #TeamFourthDownConvRatio
# 245	, #TeamMinutesPossession
# 246	, #TeamPlaysPerMinute
# 247	, #TeamPlaysPerTD
# 248	, #TeamPenaltiesPerPlays
# 249	, #TeamPossessionRatio
# 250	, #TeamPlayRatio
# 251	, #TeamExtraPointRatio
# 252	, #TeamFGPointRatio
# 253	, #TeamFGAGameRatio
# 254	, #TeamPntGameRatio
# 255	, #OppRushYdsPerAttem
# 256	, #OppPassCompletionRatio
# 257	, #OppPassYardsPerAttempt
# 258	, #OppPassYardsPerCompletion
# 259	, #OppTDsPerTotalYards
# 260	, #OppIntPerPassAttempts
# 261	, #OppSacksPerPlays
# 262	, #OppYardsPerPlay
# 263	, #OppFumblesLostPerFumbles
# 264	, #OppPenaltyYardsPerPenalty
# 265	, #OppThirdDownConvRatio
# 266	, #OppFourthDownConvRatio
# 267	, #OppMinutesPossession
# 268	, #OppPlaysPerMinute
# 269	, #OppPlaysPerTD
# 270	, #OppPenaltiesPerPlays
# 271	, #OppPossessionRatio
# 272	, #OppPlayRatio
# 273	, #OppExtraPointRatio
# 274	, #OppFGPointRatio
# 275	, #OppFGAGameRatio
# 276	, #OppPntGameRatio
277	, #MeanTeamFirstDowns
278	, #MeanTeamRushAttempts
279	, #MeanTeamRushYards
280	, #MeanTeamRushTDs
281	, #MeanTeamPassCompletions
282	, #MeanTeamPassAttempts
283	, #MeanTeamPassYards
284	, #MeanTeamPassTDs
285	, #MeanTeamInterceptions
286	, #MeanTeamSacksReceived
287	, #MeanTeamSackYardsLost
288	, #MeanTeamNetPassingYards
289	, #MeanTeamTotalYards
290	, #MeanTeamFumbles
291	, #MeanTeamFumblesLost
292	, #MeanTeamTurnovers
293	, #MeanTeamPenaltyCount
294	, #MeanTeamPenaltyYards
295	, #MeanTeamThirdDownConv
296	, #MeanTeamThirdDownAttem
297	, #MeanTeamFourthDownConv
298	, #MeanTeamFourthDownAttem
299	, #MeanTeamTotalPlays
300	, #MeanTeamXPM
301	, #MeanTeamXPA
302	, #MeanTeamFGM
303	, #MeanTeamFGA
304	, #MeanTeamPnt
305	, #MeanTeamTotalDrives
306	, #MeanTeamAvgPlaysPerDrive
307	, #MeanTeamAvgTimeLengthDrive
308	, #MeanTeamAvgYardsPerDrive
309	, #MeanOppFirstDowns
310	, #MeanOppRushAttempts
311	, #MeanOppRushYards
312	, #MeanOppRushTDs
313	, #MeanOppPassCompletions
314	, #MeanOppPassAttempts
315	, #MeanOppPassYards
316	, #MeanOppPassTDs
317	, #MeanOppInterceptions
318	, #MeanOppSacksReceived
319	, #MeanOppSackYardsLost
320	, #MeanOppNetPassingYards
321	, #MeanOppTotalYards
322	, #MeanOppFumbles
323	, #MeanOppFumblesLost
324	, #MeanOppTurnovers
325	, #MeanOppPenaltyCount
326	, #MeanOppPenaltyYards
327	, #MeanOppThirdDownConv
328	, #MeanOppThirdDownAttem
329	, #MeanOppFourthDownConv
330	, #MeanOppFourthDownAttem
331	, #MeanOppTotalPlays
332	, #MeanOppXPM
333	, #MeanOppXPA
334	, #MeanOppFGM
335	, #MeanOppFGA
336	, #MeanOppPnt
337	, #MeanOppTotalDrives
338	, #MeanOppAvgPlaysPerDrive
339	, #MeanOppAvgTimeLengthDrive
340	, #MeanOppAvgYardsPerDrive
341	, #MeanTeamRushYdsPerAttem
342	, #MeanTeamPassCompletionRatio
343	, #MeanTeamPassYardsPerAttempt
344	, #MeanTeamPassYardsPerCompletion
345	, #MeanTeamTDsPerTotalYards
346	, #MeanTeamIntPerPassAttempts
347	, #MeanTeamSacksPerPlays
348	, #MeanTeamYardsPerPlay
349	, #MeanTeamFumblesLostPerFumbles
350	, #MeanTeamPenaltyYardsPerPenalty
351	, #MeanTeamThirdDownConvRatio
352	, #MeanTeamFourthDownConvRatio
353	, #MeanTeamMinutesPossession
354	, #MeanTeamPlaysPerMinute
355	, #MeanTeamPlaysPerTD
356	, #MeanTeamPenaltiesPerPlays
357	, #MeanTeamPossessionRatio
358	, #MeanTeamPlayRatio
359	, #MeanTeamExtraPointRatio
360	, #MeanTeamFGPointRatio
361	, #MeanTeamFGAGameRatio
362	, #MeanTeamPntGameRatio
363	, #MeanOppRushYdsPerAttem
364	, #MeanOppPassCompletionRatio
365	, #MeanOppPassYardsPerAttempt
366	, #MeanOppPassYardsPerCompletion
367	, #MeanOppTDsPerTotalYards
368	, #MeanOppIntPerPassAttempts
369	, #MeanOppSacksPerPlays
370	, #MeanOppYardsPerPlay
371	, #MeanOppFumblesLostPerFumbles
372	, #MeanOppPenaltyYardsPerPenalty
373	, #MeanOppThirdDownConvRatio
374	, #MeanOppFourthDownConvRatio
375	, #MeanOppMinutesPossession
376	, #MeanOppPlaysPerMinute
377	, #MeanOppPlaysPerTD
378	, #MeanOppPenaltiesPerPlays
379	, #MeanOppPossessionRatio
380	, #MeanOppPlayRatio
381	, #MeanOppExtraPointRatio
382	, #MeanOppFGPointRatio
383	, #MeanOppFGAGameRatio
384	, #MeanOppPntGameRatio
# 385	, #LeagueMeanTeamFirstDowns
# 386	, #LeagueMeanTeamRushAttempts
# 387	, #LeagueMeanTeamRushYards
# 388	, #LeagueMeanTeamRushTDs
# 389	, #LeagueMeanTeamPassCompletions
# 390	, #LeagueMeanTeamPassAttempts
# 391	, #LeagueMeanTeamPassYards
# 392	, #LeagueMeanTeamPassTDs
# 393	, #LeagueMeanTeamInterceptions
# 394	, #LeagueMeanTeamSacksReceived
# 395	, #LeagueMeanTeamSackYardsLost
# 396	, #LeagueMeanTeamNetPassingYards
# 397	, #LeagueMeanTeamTotalYards
# 398	, #LeagueMeanTeamFumbles
# 399	, #LeagueMeanTeamFumblesLost
# 400	, #LeagueMeanTeamTurnovers
# 401	, #LeagueMeanTeamPenaltyCount
# 402	, #LeagueMeanTeamPenaltyYards
# 403	, #LeagueMeanTeamThirdDownConv
# 404	, #LeagueMeanTeamThirdDownAttem
# 405	, #LeagueMeanTeamFourthDownConv
# 406	, #LeagueMeanTeamFourthDownAttem
# 407	, #LeagueMeanTeamTotalPlays
# 408	, #LeagueMeanTeamXPM
# 409	, #LeagueMeanTeamXPA
# 410	, #LeagueMeanTeamFGM
# 411	, #LeagueMeanTeamFGA
# 412	, #LeagueMeanTeamPnt
# 413	, #LeagueMeanTeamTotalDrives
# 414	, #LeagueMeanTeamAvgPlaysPerDrive
# 415	, #LeagueMeanTeamAvgTimeLengthDrive
# 416	, #LeagueMeanTeamAvgYardsPerDrive
# 417	, #LeagueMeanTeamRushYdsPerAttem
# 418	, #LeagueMeanTeamPassCompletionRatio
# 419	, #LeagueMeanTeamPassYardsPerAttempt
# 420	, #LeagueMeanTeamPassYardsPerCompletion
# 421	, #LeagueMeanTeamTDsPerTotalYards
# 422	, #LeagueMeanTeamIntPerPassAttempts
# 423	, #LeagueMeanTeamSacksPerPlays
# 424	, #LeagueMeanTeamYardsPerPlay
# 425	, #LeagueMeanTeamFumblesLostPerFumbles
# 426	, #LeagueMeanTeamPenaltyYardsPerPenalty
# 427	, #LeagueMeanTeamThirdDownConvRatio
# 428	, #LeagueMeanTeamFourthDownConvRatio
# 429	, #LeagueMeanTeamMinutesPossession
# 430	, #LeagueMeanTeamPlaysPerMinute
# 431	, #LeagueMeanTeamPlaysPerTD
# 432	, #LeagueMeanTeamPenaltiesPerPlays
# 433	, #LeagueMeanTeamPossessionRatio
# 434	, #LeagueMeanTeamPlayRatio
# 435	, #LeagueMeanTeamExtraPointRatio
# 436	, #LeagueMeanTeamFGPointRatio
# 437	, #LeagueMeanTeamFGAGameRatio
# 438	, #LeagueMeanTeamPntGameRatio
439	, #WeightedMeanTeamFirstDowns
440	, #WeightedMeanTeamRushAttempts
441	, #WeightedMeanTeamRushYards
442	, #WeightedMeanTeamRushTDs
443	, #WeightedMeanTeamPassCompletions
444	, #WeightedMeanTeamPassAttempts
445	, #WeightedMeanTeamPassYards
446	, #WeightedMeanTeamPassTDs
447	, #WeightedMeanTeamInterceptions
448	, #WeightedMeanTeamSacksReceived
449	, #WeightedMeanTeamSackYardsLost
450	, #WeightedMeanTeamNetPassingYards
451	, #WeightedMeanTeamTotalYards
452	, #WeightedMeanTeamFumbles
453	, #WeightedMeanTeamFumblesLost
454	, #WeightedMeanTeamTurnovers
455	, #WeightedMeanTeamPenaltyCount
456	, #WeightedMeanTeamPenaltyYards
457	, #WeightedMeanTeamThirdDownConv
458	, #WeightedMeanTeamThirdDownAttem
459	, #WeightedMeanTeamFourthDownConv
460	, #WeightedMeanTeamFourthDownAttem
461	, #WeightedMeanTeamTotalPlays
462	, #WeightedMeanTeamXPM
463	, #WeightedMeanTeamXPA
464	, #WeightedMeanTeamFGM
465	, #WeightedMeanTeamFGA
466	, #WeightedMeanTeamPnt
467	, #WeightedMeanTeamTotalDrives
468	, #WeightedMeanTeamAvgPlaysPerDrive
469	, #WeightedMeanTeamAvgTimeLengthDrive
470	, #WeightedMeanTeamAvgYardsPerDrive
471	, #WeightedMeanOppFirstDowns
472	, #WeightedMeanOppRushAttempts
473	, #WeightedMeanOppRushYards
474	, #WeightedMeanOppRushTDs
475	, #WeightedMeanOppPassCompletions
476	, #WeightedMeanOppPassAttempts
477	, #WeightedMeanOppPassYards
478	, #WeightedMeanOppPassTDs
479	, #WeightedMeanOppInterceptions
480	, #WeightedMeanOppSacksReceived
481	, #WeightedMeanOppSackYardsLost
482	, #WeightedMeanOppNetPassingYards
483	, #WeightedMeanOppTotalYards
484	, #WeightedMeanOppFumbles
485	, #WeightedMeanOppFumblesLost
486	, #WeightedMeanOppTurnovers
487	, #WeightedMeanOppPenaltyCount
488	, #WeightedMeanOppPenaltyYards
489	, #WeightedMeanOppThirdDownConv
490	, #WeightedMeanOppThirdDownAttem
491	, #WeightedMeanOppFourthDownConv
492	, #WeightedMeanOppFourthDownAttem
493	, #WeightedMeanOppTotalPlays
494	, #WeightedMeanOppXPM
495	, #WeightedMeanOppXPA
496	, #WeightedMeanOppFGM
497	, #WeightedMeanOppFGA
498	, #WeightedMeanOppPnt
499	, #WeightedMeanOppTotalDrives
500	, #WeightedMeanOppAvgPlaysPerDrive
501	, #WeightedMeanOppAvgTimeLengthDrive
502	, #WeightedMeanOppAvgYardsPerDrive
503	, #WeightedMeanTeamRushYdsPerAttem
504	, #WeightedMeanTeamPassCompletionRatio
505	, #WeightedMeanTeamPassYardsPerAttempt
506	, #WeightedMeanTeamPassYardsPerCompletion
507	, #WeightedMeanTeamTDsPerTotalYards
508	, #WeightedMeanTeamIntPerPassAttempts
509	, #WeightedMeanTeamSacksPerPlays
510	, #WeightedMeanTeamYardsPerPlay
511	, #WeightedMeanTeamFumblesLostPerFumbles
512	, #WeightedMeanTeamPenaltyYardsPerPenalty
513	, #WeightedMeanTeamThirdDownConvRatio
514	, #WeightedMeanTeamFourthDownConvRatio
515	, #WeightedMeanTeamMinutesPossession
516	, #WeightedMeanTeamPlaysPerMinute
517	, #WeightedMeanTeamPlaysPerTD
518	, #WeightedMeanTeamPenaltiesPerPlays
519	, #WeightedMeanTeamPossessionRatio
520	, #WeightedMeanTeamPlayRatio
521	, #WeightedMeanTeamExtraPointRatio
522	, #WeightedMeanTeamFGPointRatio
523	, #WeightedMeanTeamFGAGameRatio
524	, #WeightedMeanTeamPntGameRatio
525	, #WeightedMeanOppRushYdsPerAttem
526	, #WeightedMeanOppPassCompletionRatio
527	, #WeightedMeanOppPassYardsPerAttempt
528	, #WeightedMeanOppPassYardsPerCompletion
529	, #WeightedMeanOppTDsPerTotalYards
530	, #WeightedMeanOppIntPerPassAttempts
531	, #WeightedMeanOppSacksPerPlays
532	, #WeightedMeanOppYardsPerPlay
533	, #WeightedMeanOppFumblesLostPerFumbles
534	, #WeightedMeanOppPenaltyYardsPerPenalty
535	, #WeightedMeanOppThirdDownConvRatio
536	, #WeightedMeanOppFourthDownConvRatio
537	, #WeightedMeanOppMinutesPossession
538	, #WeightedMeanOppPlaysPerMinute
539	, #WeightedMeanOppPlaysPerTD
540	, #WeightedMeanOppPenaltiesPerPlays
541	, #WeightedMeanOppPossessionRatio
542	, #WeightedMeanOppPlayRatio
543	, #WeightedMeanOppExtraPointRatio
544	, #WeightedMeanOppFGPointRatio
545	, #WeightedMeanOppFGAGameRatio
546	, #WeightedMeanOppPntGameRatio
547 , #roll_winratio_16
548 , #roll_winratio_32
549 , #roll_winratio_48
550 , #cum_winloss_totals
551 , #cum_winloss_totals15
#keep
49   #iswin
)
#names(final_data)[552]
#get useable data columns
use_data<-
final_data[,use_columns]
#names(use_data)
#cast to numeric those that are factors or characters
i <- sapply(use_data, is.factor)
use_data[i] <- lapply(use_data[i], as.character)
numeric_data<-use_data[,6:(length(use_data)-1)]
i <- sapply(numeric_data, is.character)
numeric_data[i]<- lapply(numeric_data[i], as.numeric)
use_data[,6:(length(use_data)-1)]<-numeric_data
#remove columns which are all NA in current year
numeric_data<-use_data[which(use_data$Date>=season_year),]
numeric_data<-numeric_data[,6:(length(numeric_data)-1)]
i <- sapply(numeric_data, function(x)all(is.na(x)))
numeric_data[i]
###############################
## adjust variables
###############################
#cap years since playoffs at 5
use_data$TeamYearsSincePlayoffs[which(use_data$TeamYearsSincePlayoffs>5)]<-5
use_data$OppYearsSincePlayoffs[which(use_data$OppYearsSincePlayoffs>5)]<-5
#cap years since playoffs same coach at 2
use_data$TeamYearsSincePlayoffsSameCoach[which(use_data$TeamYearsSincePlayoffsSameCoach>2)]<-2
use_data$OppYearsSincePlayoffsSameCoach[which(use_data$OppYearsSincePlayoffsSameCoach>2)]<-2
###############################
#########################
# use sample_parameters function to find best combination
#########################
#load function
source("C:/Users/Andy/Desktop/Personal/Coding_Projects/Football_stats/Predictions/function_sample_parameters.r")
best_accuracy_vector<- "1 2 3 4 5 8 11 12 13 14 15 17 21 22 23 28 29 31 39 40 44 45 48 56 60 61 62 64 65 68 69 70 74 75 84 85 86 91 95 314 315 316 317 35 82 83 87 89 90 281 285 286 318 63 71 77 118 131 163 248 259 260 264 278 9 59 67 80 105 111 112 135 151 174 227 47 57 319"
new_predictions_saved<-new_predictions
best_columns<-as.numeric(unlist(str_split(best_accuracy_vector[1]," ")))
names(use_data[,best_columns])
sample_parameters(best_columns,use_data, "log")
model_win_log<-model_win
model_win_cm_log<-model_win_cm
summary(model_win_log)
model_win_cm_log
new_predictions_saved<-new_predictions
text_new_predictions<-new_predictions[,1:5]
new_predictions<-new_predictions[,6:length(new_predictions)]
games<-
data.frame(cbind(text_new_predictions$Week,text_new_predictions$Date,text_new_predictions$fullname,text_new_predictions$home,text_new_predictions$OppFullname),stringsAsFactors=FALSE)
names(games)<-
c("Week","Date","Team","HomeAway","Opponent")
games$HomeAway[which(games$HomeAway==1)]<-""
games$HomeAway[which(games$HomeAway==0)]<-"@"
#select model type
model_choice<-"log"
if(model_choice=="log")
{
predictions<-
predict(model_win,  new_predictions, type="response")
} else if(model_choice=="SVM")
{
predictions<-
predict(model_win,  new_predictions, probability = TRUE)
predictions<-attr(predictions, "probabilities")[,2]
}
# assign prediction
gamescores_clean<-games
gamescores_clean$ProbabilityWin<-predictions
#reorder
gamescores_final<-
gamescores_clean[order(as.character(gamescores_clean$Date),as.character(gamescores_clean$Team)),]
# make sure prediction ratio sums to 1
adjusted_prob<-c()
for (i in 1:nrow(gamescores_final))
{#i<-1
team_prob<-gamescores_final$ProbabilityWin[i]#Team probability
opp_prob<-gamescores_final$ProbabilityWin[which(gamescores_final$Opponent==gamescores_final$Team[i]&gamescores_final$Date==gamescores_final$Date[i])] #Opp probability
adjusted_prob[i]<-team_prob/(team_prob+opp_prob)
}
#View(cbind(gamescores_final,adjusted_prob))
gamescores_final$ProbabilityWin<-adjusted_prob
## clean dataframe
gamescores_final$PredictedTeamWin[gamescores_final$ProbabilityWin>=.5]<-1
gamescores_final$PredictedTeamWin[gamescores_final$ProbabilityWin<.5]<-0
gamescores_final$ProbabilityWin<-round(gamescores_final$ProbabilityWin,digits=3)
View(gamescores_final)
write.csv(x=gamescores_final, file = paste("C:/Users/Andy/Desktop/Personal/Coding_Projects/Football_stats/Predictions/predictions_win_restOfSeason_",Sys.Date(),".csv", sep=""))
